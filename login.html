<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="Erstellen eines Dienstplanes und Wochenplanes. Die Mitarbeiter geben ihre Wünsche für Arbeitszeiten und Urlaub an.">
    <meta name="keywords" content="Dienstplan, Wochenplan, Mitarbeiter, Urlaub, Arbeitszeiten">
    <meta name="author" content="S.W.">
    <link rel="shortcut icon" type="image/png" href="logo.png">
    <link rel="stylesheet" href="./css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <!--<link type="text/css" href="/css/materialize.min.css" rel="stylesheet">--> 
    <link rel="manifest" href="/manifest.json">
    <script type="text/javascript" src="/js/materialize.min.js"></script>
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <!-- ios support -->
    <link rel="apple-touch-icon" href="../icons/icon-96x96.png">
    <!--<meta name="apple-mobile-web-app-status-bar" content="#aa7700">-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login & Register</title>
    <script type="module" src="./js/firebaseauth.js"></script>

    <style>
        .consent-group {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        .consent-checkbox {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 10px;
        }
        .consent-checkbox input[type="checkbox"] {
            margin-top: 2px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        .consent-text {
            font-size: 14px;
            line-height: 1.4;
            color: #333;
        }
        .consent-links {
            color: #007bff;
            text-decoration: none;
        }
        .consent-links:hover {
            text-decoration: underline;
        }
        .consent-error {
            color: #dc3545;
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }
        .btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            opacity: 0.6;
        }


        /* Basic styling for demo purposes 
        .container {
            max-width: 400px;
            margin: 50px auto;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
        }
        
        .form-title {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }
        
        .btn {
            width: 100%;
            padding: 12px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .btn:hover:not(:disabled) {
            background-color: #0056b3;
        }
        
        .input-group button {
            background: none;
            border: none;
            color: #007bff;
            cursor: pointer;
            text-decoration: underline;
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            color: #666;
            font-size: 12px;
        }
        
        .messageDiv {
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 4px;
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }*/
        
    </style>

</head>
<body>
    <div class="container" id="signup" style="display:none;">
      <h1 class="form-title">Registrieren</h1>
      <form method="POST" action="">
        <div id="signUpMessage" class="messageDiv" style="display:none;"></div>

        <div class="input-group">
           <i class="fas fa-user"></i>
           <input type="text"  id="fName" placeholder="Vorname" required>
           <label for="fName">Vorname</label>
        </div>
        <div class="input-group">
            <i class="fas fa-user"></i>
            <input type="text"  id="lName" placeholder="Nachname" required>
            <label for="lName">Nachname</label>
        </div>
        <div class="input-group">
            <i class="fas fa-envelope"></i>
            <input type="email"  id="rEmail" placeholder="Email" required>
            <label for="rEmail">Email</label>
        </div>
        <div class="input-group">
            <i class="fas fa-lock"></i>
            <input type="password" id="rPassword"  placeholder="Passwort" required>
            <label for="rPassword">Passwort</label>
        </div>

          <div class="consent-group" id="consentGroup" style="display:none;">
            <div class="consent-checkbox">
                <input type="checkbox" id="consentCheckbox" required>
                <div class="consent-text">
                    Ich habe die <a href="/datenschutz.html" target="_blank" class="consent-links">Datenschutzerklärung</a> 
                    und die <a href="/agb.html" target="_blank" class="consent-links">Allgemeinen Geschäftsbedingungen</a> 
                    gelesen und zur Kenntnis genommen.
                </div>
            </div>
            <div class="consent-error" id="consentError">
                Bitte stimmen Sie den Datenschutzbestimmungen und AGB zu.
            </div>
        </div>

       <button class="btn" id="submitSignUp" disabled>Registrieren</button>
      </form>
      <div class="input-group">
        <p>Du hast bereits einen Account?</p>
        <button id="signInButton">Anmelden</button>
      </div>
      <footer class="footer">&copy; 2025 - S.W.</footer>
    </div>

  <div class="container" id="signIn">
        <h1 class="form-title">Login</h1>
        <form method="POST" action="">
          <div id="signInMessage" class="messageDiv" style="display:none;"></div>

          <div class="input-group">
              <i class="fas fa-envelope"></i>
              <input type="email"  id="email" placeholder="Email" required>
              <label for="email">Email</label>
          </div>
          <div class="input-group">
              <i class="fas fa-lock"></i>
            <input type="password" id="password"  placeholder="Password" required>
              <label for="password">Passwort</label>
          </div>
          <p class="font-semibold" style="padding-bottom: 10px;">
            <a href="#" id="reset">Passwort vergessen?</a>
          </p>
         <button  class="btn"  id="submitSignIn">Anmelden</button>
        </form>
        <div class="input-group">
          <p>Du hast noch keinen Account?</p>
          <button id="signUpButton">Registrieren</button>
        </div>
        
        <footer class="footer">&copy; 2025 - S.W.</footer>
    </div>

              <script>
        // Umschaltung zwischen Login und Registrierung
        const signUpButton = document.getElementById('signUpButton');
        const signInButton = document.getElementById('signInButton');
        const signUpForm = document.getElementById('signup');
        const signInForm = document.getElementById('signIn');
        const consentGroup = document.getElementById('consentGroup');
        const consentCheckbox = document.getElementById('consentCheckbox');
        const consentError = document.getElementById('consentError');
        const submitButton = document.getElementById('submitSignUp');

        // Input-Felder für die Registrierung
        const fNameField = document.getElementById('fName');
        const lNameField = document.getElementById('lName');
        const rEmailField = document.getElementById('rEmail');
        const rPasswordField = document.getElementById('rPassword');

        signUpButton.addEventListener('click', function() {
            signInForm.style.display = 'none';
            signUpForm.style.display = 'block';
            checkFormValidity(); // Prüfe Form-Gültigkeit beim Wechsel
        });

        signInButton.addEventListener('click', function() {
            signUpForm.style.display = 'none';
            signInForm.style.display = 'block';
            consentGroup.style.display = 'none';
            submitButton.textContent = 'Registrieren';
            submitButton.disabled = true; // Button wieder deaktivieren
        });

        // Funktion zur Überprüfung der Form-Gültigkeit
        function checkFormValidity() {
            const fName = fNameField.value.trim();
            const lName = lNameField.value.trim();
            const rEmail = rEmailField.value.trim();
            const rPassword = rPasswordField.value.trim();
            
            const allFieldsFilled = fName && lName && rEmail && rPassword;
            submitButton.disabled = !allFieldsFilled;
        }

        // Event-Listener für alle Input-Felder
        [fNameField, lNameField, rEmailField, rPasswordField].forEach(field => {
            field.addEventListener('input', checkFormValidity);
        });

        // Submit-Handler für Registrierung
        submitButton.addEventListener('click', function(e) {
            e.preventDefault(); // Verhindere Standard-Submit
            
            const fName = fNameField.value.trim();
            const lName = lNameField.value.trim();
            const rEmail = rEmailField.value.trim();
            const rPassword = rPasswordField.value.trim();
            
            if (!fName || !lName || !rEmail || !rPassword) {
                alert('Bitte füllen Sie alle Felder aus.');
                return false;
            }
            
            // Zeige Checkbox-Bereich beim ersten Klick
            if (consentGroup.style.display === 'none' || !consentGroup.style.display) {
                consentGroup.style.display = 'block';
                submitButton.textContent = 'Registrierung abschließen';
                return false;
            }
            
            // Prüfe Zustimmung beim zweiten Klick
            if (!consentCheckbox.checked) {
                consentError.style.display = 'block';
                return false;
            }
            
            // Hier würde normalerweise firebaseauth.js übernehmen
            alert('Registrierung erfolgreich!');
            console.log('Registrierung mit Zustimmung durchgeführt');
        });

        // Event Listener für Checkbox (versteckt Fehlermeldung)
        consentCheckbox.addEventListener('change', function() {
            if (consentCheckbox.checked) {
                consentError.style.display = 'none';
            }
        });

         // Variable für die IP-Adresse
        let userIP = null;
        

        // IP-Adresse beim Laden der Seite abrufen
        async function getUserIP() {
            try {
                console.log('Lade IP-Adresse...');
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                userIP = data.ip;
                console.log('IP-Adresse geladen:', userIP);
                return data.ip;
            } catch (error) {
                console.warn('IP-Adresse konnte nicht ermittelt werden:', error);
                userIP = null;
                return null;
            }
        }

        // Funktion zum Speichern der Zustimmung in Firebase (wird von firebaseauth.js aufgerufen)
        window.getConsentStatus = function() {
        console.log('getConsentStatus aufgerufen, userIP:', userIP);
            return {
                consentGiven: consentCheckbox.checked,
                consentTimestamp: new Date().toISOString(),
                consentIP: userIP
            };
        };

        // Stelle sicher, dass die IP geladen ist bevor die Registrierung möglich ist
        window.isIPLoaded = function() {
            return userIP !== null;
        };

        // Initialisierung: Prüfe Form-Gültigkeit beim Laden
        document.addEventListener('DOMContentLoaded', function() {
            checkFormValidity();
        });
    </script>

    <script src="/js/app.js"></script>
    <script src="/js/script.js"></script>
    <script src="/app.js"></script>
    <script src="/firebase-init.js"></script>
    <script src="/firebase-messaging-sw.js"></script>
</body>
</html>